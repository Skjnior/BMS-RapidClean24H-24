<div th:replace="~{admin/layout :: layout(~{::content})}">
    <div th:fragment="content">
        <!-- Stats Grid -->
        <div class="stats-grid animate-fade-in">
                <div class="stat-card primary">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div>
                            <div class="stat-number" th:text="${totalRequests}">0</div>
                            <div class="stat-label">Demandes Totales</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span th:text="${pendingRequests} + ' en attente'">0 en attente</span>
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-broom"></i>
                        </div>
                        <div>
                            <div class="stat-number" th:text="${totalServices}">0</div>
                            <div class="stat-label">Services Actifs</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-check-circle"></i>
                        <span>Tous actifs</span>
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <div class="stat-number" th:text="${totalUsers}">0</div>
                            <div class="stat-label">Utilisateurs</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-user-plus"></i>
                        <span>Comptes actifs</span>
                    </div>
                </div>
                
                <div class="stat-card danger">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div>
                            <div class="stat-number" th:text="${totalMessages}">0</div>
                            <div class="stat-label">Messages</div>
                        </div>
                    </div>
                    <div class="stat-change positive" th:if="${unreadMessages != null && unreadMessages > 0}">
                        <i class="fas fa-exclamation-circle"></i>
                        <span th:text="${unreadMessages} + ' non lus'">0 non lus</span>
                    </div>
                    <div class="stat-change" th:if="${unreadMessages == null || unreadMessages == 0}">
                        <i class="fas fa-check"></i>
                        <span>Tous lus</span>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card animate-fade-in">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-bolt me-2"></i>
                        Actions Rapides
                    </h2>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <!-- CORRECTION: Utilisation de th:href -->
                            <a th:href="@{/admin/services/new}" class="btn btn-primary w-100">
                                <i class="fas fa-plus-circle me-2"></i>
                                Nouveau Service
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <!-- CORRECTION: Utilisation de th:href -->
                            <a th:href="@{/admin/requests}" class="btn btn-success w-100">
                                <i class="fas fa-clipboard-list me-2"></i>
                                Voir Demandes
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <!-- CORRECTION: Utilisation de th:href -->
                            <a th:href="@{/admin/messages}" class="btn btn-warning w-100">
                                <i class="fas fa-envelope me-2"></i>
                                Voir Messages
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <!-- CORRECTION: Utilisation de th:href -->
                            <a th:href="@{/admin/reviews}" class="btn btn-info w-100">
                                <i class="fas fa-star me-2"></i>
                                Gérer Avis
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Notifications -->
            <div class="card animate-fade-in shadow-sm" th:if="${notifications != null && !notifications.isEmpty()}" style="border: none; border-radius: 15px; overflow: hidden;">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 20px;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="card-title mb-0 text-white" style="font-size: 1.3rem; font-weight: 600;">
                            <i class="fas fa-bell me-2"></i>
                            Notifications Récentes
                        </h2>
                        <a th:href="@{/admin/notifications}" class="btn btn-sm text-white" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; padding: 6px 16px; transition: all 0.3s ease;">
                            <i class="fas fa-eye me-1"></i>Voir tout
                        </a>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="notifications-list">
                        <div class="notification-item" th:each="notification, iterStat : ${notifications}" th:if="${iterStat.index < 5}" 
                             th:classappend="${!notification.read} ? 'unread' : ''"
                             th:attr="data-priority=${notification.priority.name()}">
                            <div class="notification-icon-container">
                                <!-- Icon container avec style dynamique selon le type -->
                                <div class="notification-icon" 
                                     th:classappend="${notification.type.name() == 'NEW_MESSAGE'} ? 'type-message' : (${notification.type.name() == 'NEW_REQUEST'} ? 'type-request' : (${notification.type.name() == 'NEW_REVIEW'} ? 'type-review' : (${notification.type.name() == 'SYSTEM'} ? 'type-other' : '')))">
                                    <i class="fas fa-envelope" th:if="${notification.type.name() == 'NEW_MESSAGE'}"></i>
                                    <i class="fas fa-clipboard-list" th:if="${notification.type.name() == 'NEW_REQUEST'}"></i>
                                    <i class="fas fa-star" th:if="${notification.type.name() == 'NEW_REVIEW'}"></i>
                                    <i class="fas fa-bell" th:if="${notification.type.name() == 'SYSTEM'}"></i>
                                </div>
                                <div class="unread-indicator" th:if="${!notification.read}"></div>
                            </div>
                            <div class="notification-content">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="notification-title mb-0" th:text="${notification.title}">Titre de la notification</h6>
                                    <span class="priority-badge" 
                                          th:classappend="${(notification.priority.name() == 'HIGH' or notification.priority.name() == 'URGENT') ? 'priority-high' : (notification.priority.name() == 'MEDIUM' ? 'priority-medium' : (notification.priority.name() == 'LOW' ? 'priority-low' : ''))}"
                                          th:text="${notification.priority.displayName}">Priorité</span>
                                </div>
                                <p class="notification-message mb-2" th:text="${notification.message}">Message de la notification</p>
                                <div class="notification-footer">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        <span th:text="${#temporals.format(notification.createdAt, 'dd/MM/yyyy à HH:mm')}">Date</span>
                                    </small>
                                    <span class="notification-type-badge" th:text="${notification.type.displayName}">Type</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center p-3" th:if="${notifications.size() > 5}">
                        <a th:href="@{/admin/notifications}" class="btn btn-sm btn-outline-primary" style="border-radius: 20px;">
                            <i class="fas fa-arrow-right me-1"></i>Voir toutes les notifications
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- System Status -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie me-2"></i>
                                Statut des Demandes
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="list-group">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-clock text-warning me-2"></i> En attente</span>
                                    <span class="badge bg-pending" th:text="${pendingRequests}">0</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-check-circle text-info me-2"></i> Confirmées</span>
                                    <span class="badge bg-confirmed" th:text="${confirmedRequests}">0</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-spinner text-primary me-2"></i> En cours</span>
                                    <span class="badge bg-in-progress" th:text="${inProgressRequests}">0</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-check-double text-success me-2"></i> Terminées</span>
                                    <span class="badge bg-completed" th:text="${completedRequests}">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-star me-2"></i>
                                Avis Clients
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="stat-number text-warning" th:text="${averageRating != null ? averageRating : '0.0'}">0.0</div>
                                <div class="text-muted">Note Moyenne</div>
                                <div class="mt-2" th:if="${averageRating != null && averageRating != '0.0'}">
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                </div>
                                <div class="mt-2 text-muted" th:if="${averageRating == null || averageRating == '0.0'}">
                                    <small>Aucun avis approuvé</small>
                                </div>
                            </div>
                            
                            <div class="list-group">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>Avis approuvés</span>
                                    <span class="badge bg-success" th:text="${approvedReviews}">0</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>En attente</span>
                                    <span class="badge bg-warning" th:text="${pendingReviews}">0</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>Total</span>
                                    <span class="badge bg-primary" th:text="${totalReviews}">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        /* Badges de statut des demandes - texte en noir */
        .card-body .badge.bg-pending,
        .card-body .badge.bg-confirmed,
        .card-body .badge.bg-in-progress,
        .card-body .badge.bg-completed {
            color: #000 !important;
            font-weight: 600;
        }
        
        /* Styles pour les badges de statut si non définis */
        .badge.bg-pending {
            background-color: #ffc107 !important;
            color: #000 !important;
        }
        
        .badge.bg-confirmed {
            background-color: #17a2b8 !important;
            color: #000 !important;
        }
        
        .badge.bg-in-progress {
            background-color: #007bff !important;
            color: #000 !important;
        }
        
        .badge.bg-completed {
            background-color: #28a745 !important;
            color: #000 !important;
        }
        
        /* Styles améliorés pour les notifications */
        .notifications-list {
            padding: 0;
        }
        
        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
            background: #fff;
            position: relative;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
            box-shadow: -2px 0 8px rgba(0,0,0,0.05);
        }
        
        .notification-item.unread {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, #fff 10%);
            border-left: 4px solid #667eea;
            padding-left: 16px;
        }
        
        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
        }
        
        .notification-icon-container {
            position: relative;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .notification-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .notification-icon.type-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .notification-icon.type-request {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .notification-icon.type-review {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        }
        
        .notification-icon.type-other {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .notification-icon:not(.type-message):not(.type-request):not(.type-review):not(.type-other) {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }
        
        .unread-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
            background: #dc3545;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .notification-item.unread .notification-title {
            color: #667eea;
            font-weight: 700;
        }
        
        .notification-message {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.5;
            margin: 0;
        }
        
        .notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .priority-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .priority-badge.priority-high {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }
        
        .priority-badge.priority-medium {
            background: linear-gradient(135deg, #ffd93d 0%, #f6c23e 100%);
            color: #333;
        }
        
        .priority-badge.priority-low {
            background: linear-gradient(135deg, #95e1d3 0%, #6bcf9f 100%);
            color: white;
        }
        
        .priority-badge:not(.priority-high):not(.priority-medium):not(.priority-low) {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }
        
        .notification-type-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            background: #e9ecef;
            color: #6c757d;
            border-radius: 8px;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .notification-item {
                padding: 15px;
            }
            
            .notification-icon {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            
            .notification-title {
                font-size: 0.9rem;
            }
            
            .notification-message {
                font-size: 0.85rem;
            }
            
            .notification-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</div>
