<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle} ?: 'Employé'">Employé</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" th:href="@{/images/logo Rapidclean.png}">
    <link rel="shortcut icon" type="image/png" th:href="@{/images/logo Rapidclean.png}">
    <link rel="apple-touch-icon" th:href="@{/images/logo Rapidclean.png}">
    <link rel="stylesheet" th:href="@{/css/admin.css}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{admin/layout :: layout(~{::content})}">
    <div th:fragment="content">
        <!-- Breadcrumb -->
        <div th:replace="~{admin/fragments/breadcrumb :: breadcrumb('Employés', '/admin/employees', 'fas fa-users-cog', (employee.id == null ? 'Créer un Employé' : 'Modifier l''Employé'), 'fas fa-user-edit')}"></div>
    <style>
        .form-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .form-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 20px;
        }
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #dee2e6;
            padding: 10px 15px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
        }
        .help-note {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        /* Styles pour le champ mot de passe */
        .password-input {
            color: #2c3e50 !important;
            -webkit-text-fill-color: #2c3e50 !important;
            font-weight: 600;
        }
        .password-input::placeholder {
            color: #6c757d !important;
            -webkit-text-fill-color: #6c757d !important;
            opacity: 1;
        }
        .password-input:-webkit-autofill,
        .password-input:-webkit-autofill:hover,
        .password-input:-webkit-autofill:focus {
            -webkit-text-fill-color: #2c3e50 !important;
            -webkit-box-shadow: 0 0 0px 1000px #f8f9fa inset !important;
            box-shadow: 0 0 0px 1000px #f8f9fa inset !important;
        }
        .input-group .btn {
            border-left: none;
        }
        .input-group .form-control:not(:first-child) {
            border-left: none;
        }
    </style>
</head>
<body>
<div th:replace="~{admin/layout :: layout(~{::content})}">
    <div th:fragment="content">
        <!-- Breadcrumb -->
        <div th:replace="~{admin/fragments/breadcrumb :: breadcrumb('Employés', '/admin/employees', 'fas fa-users-cog', (employee.id == null ? 'Créer un Employé' : 'Modifier l''Employé'), 'fas fa-user-edit')}"></div>
        
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Back Button -->
        <div class="mb-4">
            <a href="/admin/employees" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i> Retour à la liste
            </a>
        </div>

        <!-- Page Header -->
        <div class="mb-4">
            <h2 class="mb-1">
                <i class="fas fa-user-tie me-2" style="color: #667eea;"></i>
                <span th:text="${user.id == null ? 'Créer un Employé' : 'Modifier l''Employé'}">Employé</span>
            </h2>
            <p class="text-muted mb-0">
                <i class="fas fa-info-circle me-1"></i>
                <span th:text="${user.id == null ? 'Ajoutez un nouvel employé à votre organisation' : 'Modifiez les informations de l''employé'}">Formulaire employé</span>
            </p>
        </div>

        <!-- Form Card -->
        <div class="card form-card">
            <div class="form-header">
                <h5 class="mb-0">
                    <i class="fas fa-id-card me-2"></i>
                    Informations de l'Employé
                </h5>
            </div>
            <div class="card-body p-4">
                <form th:action="${user.id == null ? '/admin/employees' : #strings.concat('/admin/employees/', user.id, '/update')}"
                      th:object="${user}" method="post">

                    <!-- Validation Errors -->
                    <div th:if="${#fields.hasErrors()}" class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Erreurs de validation :</strong>
                        <ul class="mb-0 mt-2">
                            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
                            <li th:each="ferr : ${#fields.errors('*')}" th:text="${ferr}"></li>
                        </ul>
                    </div>


                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h5 class="mb-3">
                            <i class="fas fa-user me-2 text-primary"></i>
                            Informations Personnelles
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user me-1 text-primary"></i>Prénom <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       th:field="*{firstName}" 
                                       class="form-control" 
                                       th:classappend="${#fields.hasErrors('firstName')} ? ' is-invalid' : ''" 
                                       required 
                                       placeholder="Entrez le prénom" />
                                <div class="invalid-feedback" th:errors="*{firstName}"></div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user me-1 text-primary"></i>Nom <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       th:field="*{lastName}" 
                                       class="form-control" 
                                       th:classappend="${#fields.hasErrors('lastName')} ? ' is-invalid' : ''" 
                                       required 
                                       placeholder="Entrez le nom" />
                                <div class="invalid-feedback" th:errors="*{lastName}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <div class="form-section">
                        <h5 class="mb-3">
                            <i class="fas fa-address-book me-2 text-info"></i>
                            Informations de Contact
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-envelope me-1 text-info"></i>Email <span class="text-danger">*</span>
                                </label>
                                <input type="email" 
                                       th:field="*{email}" 
                                       class="form-control" 
                                       th:classappend="${#fields.hasErrors('email')} ? ' is-invalid' : ''" 
                                       required 
                                       placeholder="exemple@email.com" />
                                <div class="invalid-feedback" th:errors="*{email}"></div>
                                <div class="help-note">
                                    <i class="fas fa-info-circle me-1"></i>
                                    L'email servira d'identifiant de connexion
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-phone me-1 text-success"></i>Téléphone
                                </label>
                                <input type="text" 
                                       th:field="*{phone}" 
                                       class="form-control" 
                                       th:classappend="${#fields.hasErrors('phone')} ? ' is-invalid' : ''" 
                                       placeholder="+33 6 00 00 00 00" />
                                <div class="invalid-feedback" th:errors="*{phone}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Settings Section -->
                    <div class="form-section">
                        <h5 class="mb-3">
                            <i class="fas fa-cog me-2 text-warning"></i>
                            Paramètres du Compte
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-shield-alt me-1 text-warning"></i>Rôle
                                </label>
                                <select th:field="*{role}" class="form-select" disabled>
                                    <option value="EMPLOYEE" selected>EMPLOYEE</option>
                                </select>
                                <div class="help-note">
                                    <i class="fas fa-lock me-1"></i>
                                    Le rôle est automatiquement défini sur EMPLOYEE
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-toggle-on me-1 text-success"></i>Statut
                                </label>
                                <select th:field="*{enabled}" class="form-select">
                                    <option th:value="true" th:selected="${user.enabled}">Actif</option>
                                    <option th:value="false" th:selected="${!user.enabled}">Inactif</option>
                                </select>
                                <div class="help-note">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Un compte inactif ne peut pas se connecter
                                </div>
                            </div>

                            <!-- Champ mot de passe obligatoire pour les nouveaux employés -->
                            <div class="col-md-12" th:if="${user.id == null}">
                                <label class="form-label">
                                    <i class="fas fa-key me-1 text-warning"></i>Mot de passe <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" 
                                           id="password" 
                                           name="password" 
                                           class="form-control password-input" 
                                           placeholder="Saisissez un mot de passe"
                                           required
                                           autocomplete="new-password">
                                    <button class="btn btn-outline-secondary" type="button" id="togglePasswordBtn" style="border-left: none;">
                                        <i class="fas fa-eye" id="togglePasswordIcon"></i>
                                    </button>
                                </div>
                                <div class="help-note">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Le mot de passe est obligatoire pour créer un nouvel employé. L'employé sera obligé de changer ce mot de passe lors de sa première connexion.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex gap-2 mt-4 pt-3 border-top">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save me-2"></i>
                            <span th:text="${user.id == null ? 'Créer l''Employé' : 'Mettre à Jour'}">Enregistrer</span>
                        </button>
                        <a th:href="@{/admin/employees}" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>
                            Annuler
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Script pour améliorer l'expérience utilisateur
    // Toggle password visibility
    function togglePasswordVisibility() {
        const passwordField = document.getElementById('password');
        const toggleIcon = document.getElementById('togglePasswordIcon');
        
        if (passwordField && toggleIcon) {
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Gérer l'affichage/masquage du mot de passe
        const togglePasswordBtn = document.getElementById('togglePasswordBtn');
        if (togglePasswordBtn) {
            togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
        }
        
        // Ajouter des animations aux champs de formulaire
        const inputs = document.querySelectorAll('.form-control, .form-select');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.style.transform = 'scale(1.02)';
                this.style.transition = 'all 0.3s ease';
            });
            input.addEventListener('blur', function() {
                this.style.transform = 'scale(1)';
            });
        });
    });
</script>

</body>
</html>
