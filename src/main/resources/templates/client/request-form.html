<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout}">
<head>
    <title>Demande de Service - BMS Rapid Clean</title>
</head>
<body>
    <div th:fragment="content">
        <div class="container py-4">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-lg border-0">
                        <div class="card-header text-center" style="background: var(--gradient-primary); color: white;">
                            <h3 class="mb-0">
                                <i class="fas fa-calendar-plus me-2"></i>
                                Demande de Service de Nettoyage
                            </h3>
                            <p class="mb-0 mt-2">Remplissez le formulaire ci-dessous pour demander un service</p>
                        </div>
                        
                        <div class="card-body p-4">
                            <form th:action="@{/client/request}" th:object="${serviceRequest}" method="post" data-validate>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="serviceType" class="form-label">
                                            <i class="fas fa-broom me-2"></i>Type de Service
                                        </label>
                                        <select class="form-control" id="serviceType" th:field="*{serviceType}" required>
                                            <option value="">Sélectionnez un service</option>
                                            <option th:each="service : ${services}" 
                                                    th:value="${service.name}" 
                                                    th:text="${service.name + ' - $' + service.price}"
                                                    th:data-price="${service.price}">
                                                Service
                                            </option>
                                        </select>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('serviceType')}" 
                                             th:errors="*{serviceType}"></div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="price" class="form-label">
                                            <i class="fas fa-dollar-sign me-2"></i>Prix Estimé
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="price" th:field="*{price}" 
                                                   placeholder="0.00" step="0.01" min="0" readonly>
                                        </div>
                                        <small class="form-text text-muted">Le prix sera confirmé lors de la validation</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="address" class="form-label">
                                        <i class="fas fa-map-marker-alt me-2"></i>Adresse Complète
                                    </label>
                                    <textarea class="form-control" id="address" th:field="*{address}" 
                                              rows="3" placeholder="Entrez l'adresse complète où le service doit être effectué" required></textarea>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('address')}" 
                                         th:errors="*{address}"></div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-info-circle me-2"></i>Description Détaillée
                                    </label>
                                    <textarea class="form-control" id="description" th:field="*{description}" 
                                              rows="4" placeholder="Décrivez en détail le type de nettoyage souhaité, les zones à nettoyer, les exigences particulières, etc."></textarea>
                                    <small class="form-text text-muted">Plus de détails vous aideront à obtenir un service personnalisé</small>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="serviceDate" class="form-label">
                                            <i class="fas fa-calendar me-2"></i>Date Souhaitée
                                        </label>
                                        <input type="datetime-local" class="form-control" id="serviceDate" 
                                               th:field="*{serviceDate}" required>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('serviceDate')}" 
                                             th:errors="*{serviceDate}"></div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="urgency" class="form-label">
                                            <i class="fas fa-exclamation-triangle me-2"></i>Urgence
                                        </label>
                                        <select class="form-control" id="urgency">
                                            <option value="normal">Normal (24-48h)</option>
                                            <option value="urgent">Urgent (même jour)</option>
                                            <option value="emergency">Urgence (immédiat)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Service Options -->
                                <div class="mb-4">
                                    <label class="form-label">
                                        <i class="fas fa-check-square me-2"></i>Options Supplémentaires
                                    </label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="deepCleaning">
                                                <label class="form-check-label" for="deepCleaning">
                                                    Nettoyage en profondeur
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="ecoFriendly">
                                                <label class="form-check-label" for="ecoFriendly">
                                                    Produits écologiques uniquement
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="recurring">
                                                <label class="form-check-label" for="recurring">
                                                    Service récurrent
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="insurance">
                                                <label class="form-check-label" for="insurance">
                                                    Assurance incluse
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Contact Preferences -->
                                <div class="mb-4">
                                    <label class="form-label">
                                        <i class="fas fa-phone me-2"></i>Préférences de Contact
                                    </label>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="contactMethod" id="phone" value="phone" checked>
                                                <label class="form-check-label" for="phone">
                                                    <i class="fas fa-phone me-1"></i>Téléphone
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="contactMethod" id="email" value="email">
                                                <label class="form-check-label" for="email">
                                                    <i class="fas fa-envelope me-1"></i>Email
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="contactMethod" id="sms" value="sms">
                                                <label class="form-check-label" for="sms">
                                                    <i class="fas fa-sms me-1"></i>SMS
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="/client/dashboard" class="btn btn-outline-secondary me-md-2">
                                        <i class="fas fa-arrow-left me-2"></i>Annuler
                                    </a>
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-paper-plane me-2"></i>Soumettre la Demande
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const serviceSelect = document.getElementById('serviceType');
            const priceInput = document.getElementById('price');
            const urgencySelect = document.getElementById('urgency');
            const serviceDateInput = document.getElementById('serviceDate');
            
            // Update price when service is selected
            serviceSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const price = selectedOption.dataset.price;
                if (price) {
                    priceInput.value = price;
                } else {
                    priceInput.value = '';
                }
            });
            
            // Set minimum date to today
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            serviceDateInput.min = tomorrow.toISOString().slice(0, 16);
            
            // Set default date to tomorrow
            serviceDateInput.value = tomorrow.toISOString().slice(0, 16);
            
            // Update price based on urgency
            urgencySelect.addEventListener('change', function() {
                const basePrice = parseFloat(priceInput.value) || 0;
                let multiplier = 1;
                
                switch(this.value) {
                    case 'urgent':
                        multiplier = 1.5;
                        break;
                    case 'emergency':
                        multiplier = 2;
                        break;
                }
                
                if (basePrice > 0) {
                    priceInput.value = (basePrice * multiplier).toFixed(2);
                }
            });
            
            // Form validation
            const form = document.querySelector('form[data-validate]');
            form.addEventListener('submit', function(e) {
                const serviceType = serviceSelect.value;
                const address = document.getElementById('address').value.trim();
                const serviceDate = serviceDateInput.value;
                
                if (!serviceType || !address || !serviceDate) {
                    e.preventDefault();
                    BMS.showAlert('Veuillez remplir tous les champs obligatoires.', 'danger');
                    return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const hideLoading = BMS.showLoading(submitBtn);
                
                // Simulate form submission delay
                setTimeout(() => {
                    hideLoading();
                }, 2000);
            });
        });
    </script>
</body>
</html>
